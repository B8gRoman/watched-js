$schema: "http://json-schema.org/draft-07/schema#"
definitions:
  # Captcha types
  CaptchaTypes:
    type: string
    enum: [recaptcha]
  # fetch
  TaskFetchRequest:
    type: object
    properties:
      type:
        type: string
        enum: [fetch]
      url:
        $ref: "general.yaml#/definitions/Url"
      params:
        type: object
        additionalProperties: false
        properties:
          method:
            type: string
            enum: [GET, POST, PUT, OPTIONS, DELETE, CONNECT]
            default: GET
          headers:
            type: object
          body:
            type: string
          redirect:
            type: string
            enum: [follow, manual, error]
            default: follow
        default: {}
      body:
        description: Download the response body.
        type: boolean
        default: true
    required: [type, url]
  TaskFetchResponse:
    type: object
    properties:
      type:
        type: string
        enum: [fetch]
      error:
        type: string
      status:
        type: number
      url:
        $ref: "general.yaml#/definitions/Url"
      headers:
        type: object
      json:
        oneOf:
          - type: string
          - type: number
          - type: array
          - type: object
      text:
        type: string
      data:
        description: Base64 encoded raw data.
        type: string
    required: [type, status]
  # recaptcha
  TaskRecaptchaRequest:
    type: object
    properties:
      type:
        type: string
        enum: [recaptcha]
      url:
        description: URL associated with the app (This is the domain url that you registered on Google Admin Console when getting a siteKey)
        $ref: "general.yaml#/definitions/Url"
      siteKey:
        description: A string representing the siteKey provided in the Google reCaptcha admin console.
        type: string
      version:
        description: |
          - v2: Normal reCaptcha may often require the user to click on a "I am not a robot" checkbox and solve a challenge
          - v3: Invisible reCaptcha do not require the users to solve a challenge. Refer to the reCaptcha V3 documentation for further information
        type: number
        enum: [2, 3]
      action:
        description: A string representing the ReCaptcha action (Refer to the ReCaptcha v3 document)
        type: string
    required: [type, url, siteKey]
  TaskRecaptchaResponse:
    type: object
    properties:
      type:
        type: string
        enum: [recaptcha]
      token:
        type: string
    required: [type, token]
  # Handlers
  TaskRequest:
    type: object
    properties:
      kind:
        type: string
        enum: [taskRequest]
      id:
        type: string
      data:
        oneOf:
          - $ref: "#/definitions/TaskFetchRequest"
          - $ref: "#/definitions/TaskRecaptchaRequest"
    required: [kind, id, data]
  TaskResponse:
    type: object
    properties:
      kind:
        type: string
        enum: [taskResponse]
      id:
        type: string
      data:
        oneOf:
          - $ref: "general.yaml#/definitions/Error"
          - $ref: "#/definitions/TaskFetchResponse"
          - $ref: "#/definitions/TaskRecaptchaResponse"
    required: [kind, id, data]
